<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AccelStepperI2C: firmware.ino Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AccelStepperI2C
   &#160;<span id="projectnumber">v 0.1</span>
   </div>
   <div id="projectbrief">I2C wrapper (and a bit more) for the AccelStepper Arduino library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('firmware_8ino_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">firmware.ino</div>  </div>
</div><!--header-->
<div class="contents">
<a href="firmware_8ino.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;Wire.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;AccelStepper.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="_accel_stepper_i2_c_8h.html">AccelStepperI2C.h</a>&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="_simple_buffer_8h.html">SimpleBuffer.h</a>&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;EEPROM.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#if defined(__AVR__)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;avr/wdt.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/************* firmware configuration settings **************************/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">   I2C address</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">   Change this if you want to flash the firmware with a different I2C address.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">   Alternatively, you can use setI2Caddress() from the library to change it later</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a6335b7c0e0151e1f0fca222235cb4ee0">   42</a></span>&#160;<span class="keyword">const</span> uint8_t <a class="code" href="firmware_8ino.html#a6335b7c0e0151e1f0fca222235cb4ee0">slaveDefaultAddress</a> = 0x08; <span class="comment">// default</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">   uncomment and define max. number of servos</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   to enable servo support</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ae0e9d7a6def6d9fef4d0febcbadbda25">   48</a></span>&#160;<span class="preprocessor">#define SERVO_SUPPORT</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">   49</a></span>&#160;<span class="keyword">const</span> uint8_t <a class="code" href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">maxServos</a> = 4;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ad72dbcf6d0153db1b8d8a58001feed83">   55</a></span>&#160;<span class="preprocessor">#define DEBUG</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//#define DIAGNOSTICS</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/******* end of firmware configuration settings **************************/</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/************************************************************************/</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">   Servo stuff</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#if defined(SERVO_SUPPORT)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#if defined(__AVR__) || defined(ESP8266)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &lt;Servo.h&gt;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#elif defined(ESP32)</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &lt;ESP32Servo.h&gt;</span> <span class="comment">// ESP32 doesn&#39;t come with a native Servo.h</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#endif // defined(__AVR__)</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_servo_i2_c_8h.html">ServoI2C.h</a>&quot;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">   84</a></span>&#160;Servo <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[<a class="code" href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">maxServos</a>]; <span class="comment">// ### really allocate all of them now?</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">   85</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a> = 0; <span class="comment">// number of initialised servos.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#endif // defined(SERVO_SUPPORT)</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">   Debugging stuff</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">   94</a></span>&#160;<span class="preprocessor">#define log(...)       Serial.print(__VA_ARGS__)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ab2458d18375b44e68abd4672fe965562">   95</a></span>&#160;<span class="keyword">volatile</span> uint8_t <a class="code" href="firmware_8ino.html#ab2458d18375b44e68abd4672fe965562">writtenToBuffer</a> = 0;</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">   96</a></span>&#160;<span class="keyword">volatile</span> uint8_t <a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a> = 0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#define log(...)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#endif // DEBUG</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a570420b17131e93d2c3ff7665f121800">  102</a></span>&#160;uint32_t <a class="code" href="firmware_8ino.html#ad2a5acb9b13b943cac9ef0b8c8370100">now</a>, <a class="code" href="firmware_8ino.html#a570420b17131e93d2c3ff7665f121800">then</a> = millis();</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">  103</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="firmware_8ino.html#acee4f8c66bd06079db7157d155550ede">  104</a></span>&#160;uint32_t <a class="code" href="firmware_8ino.html#acee4f8c66bd06079db7157d155550ede">lastCycles</a> = 0; <span class="comment">// for simple cycles/reportPeriod diagnostics</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="firmware_8ino.html#aab25d82c1087f38c24fedd257e192278">  105</a></span>&#160;<span class="keyword">const</span> uint32_t <a class="code" href="firmware_8ino.html#aab25d82c1087f38c24fedd257e192278">reportPeriod</a> = 2000; <span class="comment">// ms between main loop simple diagnostics output</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#endif // DEBUG</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">   Diagnostics stuff</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keywordtype">bool</span> diagnosticsEnabled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;uint32_t thenMicros;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<a class="code" href="structdiagnostics_report.html">diagnosticsReport</a> currentDiagnostics;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;uint32_t previousLastReceiveTime; <span class="comment">// used to delay receive times by one receive event</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">  120</a></span>&#160;uint32_t <a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a> = 0; <span class="comment">// keeps count of main loop iterations</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">   EEPROM stuff</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a1cad4e2514f451585f15da3b8ee3cd2f">  127</a></span>&#160;<span class="preprocessor">#define EEPROM_OFFSET_I2C_ADDRESS 0 // where in eeprom is the I2C address stored, if any? [1 CRC8 + 4 marker + 1 address = 6 bytes]</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a8633d2064ee1822248523a0c402920e3">  128</a></span>&#160;<span class="keyword">const</span> uint32_t <a class="code" href="firmware_8ino.html#a8633d2064ee1822248523a0c402920e3">eepromI2CaddressMarker</a> = 0x12C0ACCF; <span class="comment">// arbitrary 32bit marker proving that next byte in EEPROM is in fact an I2C address</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#if defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">const</span> uint32_t eepromUsedSize = 6; <span class="comment">// total bytes of EEPROM used by us</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#endif // defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">   I2C stuff</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">  138</a></span>&#160;<a class="code" href="class_simple_buffer.html">SimpleBuffer</a>* <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">  139</a></span>&#160;<a class="code" href="class_simple_buffer.html">SimpleBuffer</a>* <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">  140</a></span>&#160;<span class="keyword">volatile</span> uint8_t <a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a> = 0; <span class="comment">// signals main loop that a receiveEvent with valid new data occurred</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a9d641c48e9eaae758eb0ea69cdbfa9c7">  146</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a9d641c48e9eaae758eb0ea69cdbfa9c7">retrieveI2C_address</a>()</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="class_simple_buffer.html">SimpleBuffer</a> b;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  b.<a class="code" href="class_simple_buffer.html#a4fe86d8150428e236dd5958662da1b94">init</a>(8);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">// read 6 bytes from eeprom: [0]=CRC8; [1-4]=marker; [5]=address</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">//log(&quot;Reading from EEPROM: &quot;);</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#if defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  EEPROM.begin(256);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#endif // defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">byte</span> i = 0; i &lt; 6; i++) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    b.<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i] = EEPROM.read(<a class="code" href="firmware_8ino.html#a1cad4e2514f451585f15da3b8ee3cd2f">EEPROM_OFFSET_I2C_ADDRESS</a> + i);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// log(b.buffer[i]); log (&quot; &quot;);</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#if defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  EEPROM.end();</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#endif // defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// we wrote directly to the buffer, so reader idx is still at 1</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  uint32_t markerTest; b.<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(markerTest);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  uint8_t storedAddress; b.<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(storedAddress); <span class="comment">// now idx will be at 6, so that CRC check below will work</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (b.<a class="code" href="class_simple_buffer.html#a1c32cae8a445215aa333609cef8b7b11">checkCRC8</a>() and (markerTest == <a class="code" href="firmware_8ino.html#a8633d2064ee1822248523a0c402920e3">eepromI2CaddressMarker</a>)) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> storedAddress;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="firmware_8ino.html#a6335b7c0e0151e1f0fca222235cb4ee0">slaveDefaultAddress</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a04dab60aa1102ee6bfabfc6a039849ee">  178</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a04dab60aa1102ee6bfabfc6a039849ee">storeI2C_address</a>(uint8_t <a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;{</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="class_simple_buffer.html">SimpleBuffer</a> b;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  b.<a class="code" href="class_simple_buffer.html#a4fe86d8150428e236dd5958662da1b94">init</a>(8);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  b.<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a8633d2064ee1822248523a0c402920e3">eepromI2CaddressMarker</a>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  b.<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  b.<a class="code" href="class_simple_buffer.html#a4df34a56ad455801e52c7524ec48d8d3">setCRC8</a>();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;Writing to EEPROM: &quot;</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#if defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  EEPROM.begin(32);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#endif // defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">byte</span> i = 0; i &lt; 6; i++) { <span class="comment">// [0]=CRC8; [1-4]=marker; [5]=address</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    EEPROM.write(<a class="code" href="firmware_8ino.html#a1cad4e2514f451585f15da3b8ee3cd2f">EEPROM_OFFSET_I2C_ADDRESS</a> + i, b.<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i]);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">//EEPROM.put(EEPROM_OFFSET_I2C_ADDRESS + i, b.buffer[i]);</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">//delay(120);</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(b.<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i]); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a> (<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">#if defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  EEPROM.end(); <span class="comment">// end() will also commit()</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#endif // defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">   Interrupt (to master) stuff</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">   note: The interrupt pin is global, as there is only one shared by all steppers.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">   However, interrupts can be enabled for each stepper seperately.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">  208</a></span>&#160;int8_t <a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a> = -1; <span class="comment">// -1 for undefined</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">  209</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">interruptActiveHigh</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">  210</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">interruptSource</a> = 0xF;</div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">  211</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">interruptReason</a> = <a class="code" href="group___interrupt_reasons.html#ga1f90e0f512487244a9afb99cac141660">interruptReason_none</a>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">   Endstop stuff</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="struct_endstop.html">  217</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_endstop.html">Endstop</a></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="struct_endstop.html#a2eed94b6d3cb330c1c3f92bdc6a96f87">  219</a></span>&#160;  uint8_t <a class="code" href="struct_endstop.html#a2eed94b6d3cb330c1c3f92bdc6a96f87">pin</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="struct_endstop.html#a62dca12651ef2c7a1b20ba9fd1df4146">  220</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="struct_endstop.html#a62dca12651ef2c7a1b20ba9fd1df4146">activeLow</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">//bool internalPullup; // we don&#39;t need to store this, we can directly use it when adding the pin</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;};</div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="firmware_8ino.html#aa84ea5f47409c6c60bc911ba4bc06fb0">  223</a></span>&#160;<span class="keyword">const</span> uint8_t <a class="code" href="firmware_8ino.html#aa84ea5f47409c6c60bc911ba4bc06fb0">maxEndstops</a> = 2; <span class="comment">// not sure if there are scenarios where more than two make sense, but why not be prepared and make this configurable?</span></div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a82c2dca294e6df8a284651b486985d11">  224</a></span>&#160;<span class="keyword">const</span> uint32_t <a class="code" href="firmware_8ino.html#a82c2dca294e6df8a284651b486985d11">endstopDebouncePeriod</a> = 5; <span class="comment">// millisecends to keep between triggering endstop interrupts; I measured a couple of switches, none bounced longer than 1 ms so this should be more than safe</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">   Stepper stuff</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4b5902c36f57eccdc4e911f63edcd14b">  230</a></span>&#160;<span class="keyword">const</span> uint8_t <a class="code" href="firmware_8ino.html#a4b5902c36f57eccdc4e911f63edcd14b">maxSteppers</a> = 8;</div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">  231</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a> = 0; <span class="comment">// number of initialised steppers</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="struct_stepper.html">  236</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_stepper.html">Stepper</a></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">  238</a></span>&#160;  AccelStepper* <a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">  239</a></span>&#160;  uint8_t <a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">  240</a></span>&#160;  <a class="code" href="struct_endstop.html">Endstop</a> <a class="code" href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">endstops</a>[<a class="code" href="firmware_8ino.html#aa84ea5f47409c6c60bc911ba4bc06fb0">maxEndstops</a>];</div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">  241</a></span>&#160;  uint8_t <a class="code" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">numEndstops</a> = 0;</div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="struct_stepper.html#aafb876574872c4278bd330a60cdefc4a">  242</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="struct_stepper.html#aafb876574872c4278bd330a60cdefc4a">interruptsEnabled</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="struct_stepper.html#af5fb2f1b7e77f723afebf5f5a4a378ca">  243</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="struct_stepper.html#af5fb2f1b7e77f723afebf5f5a4a378ca">endstopsEnabled</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="struct_stepper.html#a178865b71f7ed8c5b63546fb0b82bb28">  244</a></span>&#160;  uint8_t <a class="code" href="struct_stepper.html#a178865b71f7ed8c5b63546fb0b82bb28">prevEndstopState</a>; <span class="comment">// needed for detecting rising and falling flanks</span></div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="struct_stepper.html#a84037efe9d1722547a3cc36ebdb6b55d">  245</a></span>&#160;  uint32_t <a class="code" href="struct_stepper.html#a84037efe9d1722547a3cc36ebdb6b55d">endstopDebounceEnd</a> = 0; <span class="comment">// used for debouncing, endstops are ignored after a new flank until this time is reached</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;};</div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">  247</a></span>&#160;<a class="code" href="struct_stepper.html">Stepper</a> <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[<a class="code" href="firmware_8ino.html#a4b5902c36f57eccdc4e911f63edcd14b">maxSteppers</a>];</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  Reset stuff</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ab45a881cd27fd11dbc87571c6a9cba34">  254</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#ab45a881cd27fd11dbc87571c6a9cba34">resetFunc</a>()</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">#if defined(__AVR__)</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// The watchdog method supposedly is the preferred one, however it did not make my Nano restart normally,</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// I think maybe it got stuck in the bootloader.</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// cli();</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">// wdt_enable(WDTO_30MS);</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// for (;;);</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// so let&#39;s just go for the stupid version, it should work fine for the firmware:</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">asm</span> <span class="keyword">volatile</span> (<span class="stringliteral">&quot; jmp 0&quot;</span>);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#elif defined(ESP32) || defined(ESP8266)</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  ESP.restart();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4fc01d736fe50cf5b977f755b675f11d">  276</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>()</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  Serial.begin(115200);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n\n\n=== AccelStepperI2C v&quot;</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="version_8h.html#a18005e714d083d578e7471e9a3dc5355">VersionMajor</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;.&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="version_8h.html#af4071954c3e1aa6709a2ffff0ce9bc05">VersionMinor</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;.&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="version_8h.html#ae9175e671a844995c3b1474ff2341a03">VersionPatch</a>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; ===\n\n&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  uint8_t i2c_address = <a class="code" href="firmware_8ino.html#a9d641c48e9eaae758eb0ea69cdbfa9c7">retrieveI2C_address</a>();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  Wire.begin(i2c_address);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;I2C started with address &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(i2c_address); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  Wire.onReceive(<a class="code" href="firmware_8ino.html#a9a52aa0319b0d3bea95eff4528baee98">receiveEvent</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  Wire.onRequest(<a class="code" href="firmware_8ino.html#ac10b80b8aaeaf66cecbf0bb5eff5ae33">requestEvent</a>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a> = <span class="keyword">new</span> <a class="code" href="class_simple_buffer.html">SimpleBuffer</a>; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a4fe86d8150428e236dd5958662da1b94">init</a>(<a class="code" href="_accel_stepper_i2_c_8h.html#afafaa62910a60220ce0b83ecfed27e43">AccelStepperI2CmaxBuf</a>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a> = <span class="keyword">new</span> <a class="code" href="class_simple_buffer.html">SimpleBuffer</a>; <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a4fe86d8150428e236dd5958662da1b94">init</a>(<a class="code" href="_accel_stepper_i2_c_8h.html#afafaa62910a60220ce0b83ecfed27e43">AccelStepperI2CmaxBuf</a>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ae2a8610cdcfb2697510a8ee83499558e">  305</a></span>&#160;int8_t <a class="code" href="firmware_8ino.html#ae2a8610cdcfb2697510a8ee83499558e">addStepper</a>(uint8_t interface = AccelStepper::FULL4WIRE,</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                  uint8_t pin1 = 2,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                  uint8_t pin2 = 3,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                  uint8_t pin3 = 4,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                  uint8_t pin4 = 5,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                  <span class="keywordtype">bool</span> enable = <span class="keyword">true</span>)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a> &lt; <a class="code" href="firmware_8ino.html#a4b5902c36f57eccdc4e911f63edcd14b">maxSteppers</a>) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[<a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a> = <span class="keyword">new</span> AccelStepper(interface, pin1, pin2, pin3, pin4, enable);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[<a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>].<a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;Add stepper with internal myNum = &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>++;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;-- Too many steppers, failed to add new one\n&quot;</span>);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">   Read endstop(s) for stepper s.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">   Returns bit pattern, last added endstop is LSB; 0 for inactive, 1 for active (taking activeLow in account)</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">   Returns 0x0 if no endstops set.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">  330</a></span>&#160;uint8_t <a class="code" href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">pollEndstops</a>(uint8_t s)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  uint8_t res = 0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[s].<a class="code" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">numEndstops</a>; i++) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">//log(i); log(&quot; p&quot;);</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">//log(digitalRead(steppers[s].endstops[i].pin));  log(&quot; &quot;);</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    res = (res &lt;&lt; 1) | (digitalRead(<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[s].endstops[i].pin) ^ <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[s].<a class="code" href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">endstops</a>[i].<a class="code" href="struct_endstop.html#a62dca12651ef2c7a1b20ba9fd1df4146">activeLow</a>); <span class="comment">// xor</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">//log(&quot; res=&quot;); log(res);       log(&quot; &quot;);</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">   Interrupt master if interrupts are enabled for the source stepper.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">  347</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">triggerInterrupt</a>(uint8_t source, uint8_t reason)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[source].interruptsEnabled and <a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a> &gt;= 0) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;~~ interrupt master with source = &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(source);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; and reason = &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(reason); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    digitalWrite(<a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a>, <a class="code" href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">interruptActiveHigh</a> ? HIGH : LOW);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">interruptSource</a> = source;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">interruptReason</a> = reason;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno"><a class="line" href="firmware_8ino.html#adebb2a389a701d95bb721df60053bf6c">  358</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#adebb2a389a701d95bb721df60053bf6c">clearInterrupt</a>()</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a> &gt;= 0) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    digitalWrite(<a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a>, <a class="code" href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">interruptActiveHigh</a> ? LOW : HIGH);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="firmware_8ino.html#afe461d27b9c48d5921c00d521181f12f">  376</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#afe461d27b9c48d5921c00d521181f12f">loop</a>()</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;{</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="firmware_8ino.html#ad2a5acb9b13b943cac9ef0b8c8370100">now</a> = millis();</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#ad2a5acb9b13b943cac9ef0b8c8370100">now</a> &gt; <a class="code" href="firmware_8ino.html#a570420b17131e93d2c3ff7665f121800">then</a>) { <span class="comment">// report cycles/reportPeriod statistics and state machine states for all defined steppers</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n    &gt; Cycles/s = &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>((<a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a> - <a class="code" href="firmware_8ino.html#acee4f8c66bd06079db7157d155550ede">lastCycles</a>) * 1000 / <a class="code" href="firmware_8ino.html#aab25d82c1087f38c24fedd257e192278">reportPeriod</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">//log(&quot;Cycles = &quot;); log(cycles);</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a> &gt; 0) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;  | [Steppers]:states =&quot;</span>);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="firmware_8ino.html#acee4f8c66bd06079db7157d155550ede">lastCycles</a> = <a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="firmware_8ino.html#a570420b17131e93d2c3ff7665f121800">then</a> = <a class="code" href="firmware_8ino.html#ad2a5acb9b13b943cac9ef0b8c8370100">now</a> + <a class="code" href="firmware_8ino.html#aab25d82c1087f38c24fedd257e192278">reportPeriod</a>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>; i++) {  <span class="comment">// cycle through all defined steppers</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a>) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;  [&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(i); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;]:&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].state);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">bool</span> timeToCheckTheEndstops = <span class="keyword">false</span>; <span class="comment">// ###todo: change polling to pinchange interrupt</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// ### do we need this at all? Why not just poll each cycle? It doesn&#39;t take very long.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].state) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a60eef344c72bf4ef956d52dbc71e575e">state_run</a>: <span class="comment">// boolean AccelStepper::run</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span> (not <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].stepper-&gt;run()) { <span class="comment">// target reached?</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <a class="code" href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">triggerInterrupt</a>(i, <a class="code" href="group___interrupt_reasons.html#ga73e92a247880625865cb90183f956875">interruptReason_targetReachedByRun</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        timeToCheckTheEndstops = <span class="keyword">true</span>; <span class="comment">// we cannot tell if there was a step, so we&#39;ll have to check every time. (one more reason to do it with interrupts)</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a3bbebd6c8b4bd27f6a93cd6d7d15b296">state_runSpeed</a>:  <span class="comment">// boolean AccelStepper::runSpeed</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        timeToCheckTheEndstops = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;runSpeed(); <span class="comment">// true if stepped</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a33b3a368a4769f3e1ef4c7b7e5e4ec32">state_runSpeedToPosition</a>:  <span class="comment">// boolean AccelStepper::runSpeedToPosition</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        timeToCheckTheEndstops = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;runSpeedToPosition();  <span class="comment">// true if stepped</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].stepper-&gt;distanceToGo() == 0) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          <span class="comment">// target reached, stop polling</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <a class="code" href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">triggerInterrupt</a>(i, <a class="code" href="group___interrupt_reasons.html#ga69a3d7d4ea76a6171ea62f657aa6aa90">interruptReason_targetReachedByRunSpeedToPosition</a>);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>: <span class="comment">// do nothing</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    } <span class="comment">// switch</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a>) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <a class="code" href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (timeToCheckTheEndstops and <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].endstopsEnabled) { <span class="comment">// the stepper (potentially) stepped a step, so let&#39;s look at the endstops</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      uint8_t es = <a class="code" href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">pollEndstops</a>(i);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">if</span> (es != <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].prevEndstopState) { <span class="comment">// detect rising *or* falling flank</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        uint32_t ms = millis();</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span> (ms &gt; <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].endstopDebounceEnd) { <span class="comment">// primitive debounce: ignore endstops for some ms after each new flank</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;** es: flank detected  \n&quot;</span>);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#a84037efe9d1722547a3cc36ebdb6b55d">endstopDebounceEnd</a> = ms + <a class="code" href="firmware_8ino.html#a82c2dca294e6df8a284651b486985d11">endstopDebouncePeriod</a>; <span class="comment">// set end of debounce period</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#a178865b71f7ed8c5b63546fb0b82bb28">prevEndstopState</a> = es;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          <span class="keywordflow">if</span> (es != 0) { <span class="comment">// this is a non-bounce, *rising* flank</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;** es: endstop detected!\n&quot;</span>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="comment">//steppers[i].stepper-&gt;stop();</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setSpeed(0);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;moveTo(<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].stepper-&gt;currentPosition());</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[i].<a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = <a class="code" href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a>; <span class="comment">// endstop reached, stop polling</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <a class="code" href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">triggerInterrupt</a>(i, <a class="code" href="group___interrupt_reasons.html#ga95cdb0448ea51cc3ea41bc96e96f59dc">interruptReason_endstopHit</a>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    } <span class="comment">// check endstops</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  } <span class="comment">// for</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// Check for new incoming messages from I2C interrupt</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a> &gt; 0) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="firmware_8ino.html#a4906408a38ad9d4f1bca763aa75422ad">processMessage</a>(<a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a> = 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a> &gt; 0) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;Output buffer sent (&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; bytes): &quot;</span>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">for</span> (uint8_t j = 0; j &lt; <a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a>; j++) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[j]);  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a> = 0;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a>++;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor">#if defined(ESP8266)</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;ICACHE_RAM_ATTR</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a9a52aa0319b0d3bea95eff4528baee98">  490</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a9a52aa0319b0d3bea95eff4528baee98">receiveEvent</a>(<span class="keywordtype">int</span> howMany)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;{</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  thenMicros = micros();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(howMany); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; I\n&quot;</span>);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a> == 0) { <span class="comment">// Only accept message if an earlier one is fully processed.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a0408a7143a40a819685a2de0ae16bcb3">reset</a>();</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; howMany; i++) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i] = Wire.read();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a> = howMany;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a> = howMany; <span class="comment">// tell main loop that new data has arrived</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">// discard message ### how can we warn the master??? Use interrupt?</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">while</span> (Wire.available()) { <span class="comment">// discard data (### needed?)</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      Wire.read();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">// delay storing the executing time for one cycle, else diagnostics() would always return</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// its own receive time, not the one of the previous command</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  currentDiagnostics.<a class="code" href="structdiagnostics_report.html#a6d270ecf9a6ae1f8e717a879c54fc9bd">lastReceiveTime</a> = previousLastReceiveTime;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  previousLastReceiveTime = micros() - thenMicros;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">  520</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(int8_t s)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">return</span> (s &gt;= 0) and (s &lt; <a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">  525</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(int8_t s)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;{</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">return</span> (s &gt;= 0) and (s &lt; <a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;}</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00549"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a4906408a38ad9d4f1bca763aa75422ad">  549</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a4906408a38ad9d4f1bca763aa75422ad">processMessage</a>(uint8_t len)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;{</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  uint32_t thenMicrosP = micros();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;New message with &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(len); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; bytes. &quot;</span>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; len; j++)  { <span class="comment">// I expect the compiler will optimize this away if debugging is off</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a> (<a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[j]); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a1c32cae8a445215aa333609cef8b7b11">checkCRC8</a>()) {  <span class="comment">// ignore invalid message ### how to warn the master?</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a0408a7143a40a819685a2de0ae16bcb3">reset</a>(); <span class="comment">// set reader to beginning of message</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    uint8_t cmd; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(cmd);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    int8_t unit; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(unit); <span class="comment">// stepper/servo/etc. addressed (if any, will not be used for general commands)</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    int8_t i = len - 3 ; <span class="comment">// bytes received minus 3 header bytes = number of parameter bytes</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;CRC8 ok. Command = &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(cmd); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; for unit &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(unit);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; with &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(i); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; parameter bytes --&gt; &quot;</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">//    if ((cmd &gt;= generalCommandsStart) or ((unit &gt;= 0) and</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">//#if defined(SERVO_SUPPORT) // unit can refer to steppers *or* servos</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">//                                          (unit &lt; (cmd &gt;= servoCommandsStart ? numServos : numSteppers))</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">//#else // unit refers to steppers</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">//                                          (unit &lt; numSteppers)</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">//#endif //defined(SERVO_SUPPORT)</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">//                                         )) {</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a0408a7143a40a819685a2de0ae16bcb3">reset</a>();  <span class="comment">// let&#39;s hope last result was already requested by master, as now it&#39;s gone</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">switch</span> (cmd) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a84c7d8262a16efd1f7619fd8978bc89f">moveToCmd</a>: { <span class="comment">// void   moveTo (long absolute)</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 long parameter (not nice to have these constants hardcoded here, but what the heck)</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordtype">long</span> l = 0;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(l);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;moveTo(l);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a5bc0135fc6c2b403837faaef6ab7c638">moveCmd</a>: { <span class="comment">// void   move (long relative)</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 long parameter</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="keywordtype">long</span> l = 0;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(l);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;move(l);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">// usually not to be called directly via I2C, use state machine instead</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#ac5a577b7b05194baa66adb3e5a00d4ee">runCmd</a>: { <span class="comment">// boolean  run ()</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordtype">bool</span> res = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;run();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(res);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">// usually not to be called directly via I2C, use state machine instead</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a1dc7abae7acd49723430005dcd7ab563">runSpeedCmd</a>: { <span class="comment">//  boolean   runSpeed ()</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordtype">bool</span> res = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;runSpeed();</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(res);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a6aee218a8369544c588e6a1738d0ef5b">setMaxSpeedCmd</a>: { <span class="comment">// void   setMaxSpeed (float speed)</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 long parameter</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordtype">float</span> f = 0;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(f);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setMaxSpeed(f);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#adb260163a19a3ecc78a1d8bd022ee4b7">maxSpeedCmd</a>: { <span class="comment">// float  maxSpeed ()</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordtype">float</span> f = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;maxSpeed();</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(f);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#ac67d1b7ccff8a2bc120abe262b738b57">setAccelerationCmd</a>: { <span class="comment">// void   setAcceleration (float acceleration)</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 float parameter</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="keywordtype">float</span> f = 0;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(f);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setAcceleration(f);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#ae5db942dd8541e9221efd1efa54d54ec">setSpeedCmd</a>: { <span class="comment">// void   setSpeed (float speed)</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 float parameter</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordtype">float</span> f = 0;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(f);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setSpeed(f);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a8bd4f1641834c3100eee45ba9df22ad8">speedCmd</a>: { <span class="comment">// float  speed ()</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <span class="keywordtype">float</span> f = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;speed();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(f);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a8533b53e7a9817dd082d33d58f095826">distanceToGoCmd</a>: { <span class="comment">// long   distanceToGo ()</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordtype">long</span> l = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;distanceToGo();</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(l);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#aaf459ccf307b8b26517bd3d16ccbd288">targetPositionCmd</a>: { <span class="comment">// long   targetPosition ()</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordtype">long</span> l = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;targetPosition();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(l);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a75da675711616279a4bbd6797d4d0342">currentPositionCmd</a>: { <span class="comment">// long   currentPosition ()</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordtype">long</span> l = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;currentPosition();</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(l);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#adaf29ee0d70159646b34b11c4dd7b193">setCurrentPositionCmd</a>: { <span class="comment">// void   setCurrentPosition (long position)</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 4)) { <span class="comment">// 1 long parameter</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordtype">long</span> l = 0;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(l);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setCurrentPosition(l);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        }</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">// blocking, not implemented (yet?)</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a170d54f56d535f30b6cb09321e89c754">runToPositionCmd</a>:  <span class="comment">// void   runToPosition () {}</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="comment">// usually not to be called directly via I2C, use state machine instead</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a7df5712fcf7469a487b493f4f6e29806">runSpeedToPositionCmd</a>: { <span class="comment">// boolean  runSpeedToPosition ()</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordtype">bool</span> res = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;runSpeedToPosition();</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(res);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="comment">// blocking, not implemented (yet?)</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#ab6da5e42caa09167ae7c403ab66d53b8">runToNewPositionCmd</a>: <span class="comment">// void   runToNewPosition (long position) {}</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a701b5c3b5816e355a8cec77d581ac415">stopCmd</a>: { <span class="comment">// void   stop ()</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;stop();</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a1d50a416712971c3f761558f04ce26b1">disableOutputsCmd</a>: { <span class="comment">// virtual void   disableOutputs ()</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;disableOutputs();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;          }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a6e2496370a11671546a817ef5b8a2aae">enableOutputsCmd</a>: { <span class="comment">// virtual void   enableOutputs ()</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;enableOutputs();</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a1f4c45d7bdeb39248284aff560efba37">setMinPulseWidthCmd</a>: { <span class="comment">// void   setMinPulseWidth (unsigned int minWidth)</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 2)) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="comment">// 1 uint16</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            uint16_t minW = 0;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(minW);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setMinPulseWidth(minW);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a105a8a1e3441e35a9c6cf7ff03cf47d5">setEnablePinCmd</a>: { <span class="comment">// void   setEnablePin (uint8_t enablePin=0xff)</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="comment">// 1 uint8_t</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            uint8_t pin = 0;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setEnablePin(pin);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a3537c8d1234ff7b177af8fad522cc948">setPinsInverted1Cmd</a>: { <span class="comment">// void   setPinsInverted (bool directionInvert=false, bool stepInvert=false, bool enableInvert=false)</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="comment">// 8 bits</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            uint8_t b = 0;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(b);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setPinsInverted(</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;              (b &amp; 1 &lt;&lt; 0) != 0, (b &amp; 1 &lt;&lt; 1) != 0, (b &amp; 1 &lt;&lt; 2) != 0);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#abbb5564cfde6eb726771ee16e25d86db">setPinsInverted2Cmd</a>: { <span class="comment">//  void  setPinsInverted (bool pin1Invert, bool pin2Invert, bool pin3Invert, bool pin4Invert, bool enableInvert)</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="comment">// 8 bits</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            uint8_t b;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(b);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;setPinsInverted(</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;              (b &amp; 1 &lt;&lt; 0) != 0, (b &amp; 1 &lt;&lt; 1) != 0, (b &amp; 1 &lt;&lt; 2) != 0, (b &amp; 1 &lt;&lt; 3) != 0, (b &amp; 1 &lt;&lt; 4) != 0);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a65d7f026e933ce3930c0f50e07c29236">isRunningCmd</a>: { <span class="comment">// bool   isRunning ()</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="keywordtype">bool</span> b = <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;isRunning();</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(b);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="comment">// AccelstepperI2C state machine commands</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a3db87eefb7aaa178dba1453ed1ab7b7c">setStateCmd</a>: { <span class="comment">//</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) { <span class="comment">// 1 uint8_t</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            uint8_t newState;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(newState);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">state</a> = newState;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a0b114f5865a1a8fa4461a70a3e76ee07">getStateCmd</a>: { <span class="comment">//</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].state);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a4b583eb01c6dd23a01f556d9164f9dfc">setEndstopPinCmd</a>: { <span class="comment">//</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 3) and (<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].numEndstops &lt; <a class="code" href="firmware_8ino.html#aa84ea5f47409c6c60bc911ba4bc06fb0">maxEndstops</a>)) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            int8_t pin; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordtype">bool</span> activeLow; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(activeLow);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordtype">bool</span> internalPullup; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(internalPullup);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">endstops</a>[<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">numEndstops</a>].<a class="code" href="struct_endstop.html#a2eed94b6d3cb330c1c3f92bdc6a96f87">pin</a> = pin;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">endstops</a>[<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">numEndstops</a>].<a class="code" href="struct_endstop.html#a62dca12651ef2c7a1b20ba9fd1df4146">activeLow</a> = activeLow;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            pinMode(pin, internalPullup ? INPUT_PULLUP : INPUT);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">numEndstops</a>++;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a6548116a836f7410be00e096b8395ce0">enableEndstopsCmd</a>: {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) { <span class="comment">// 1 bool</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordtype">bool</span> en; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(en);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#af5fb2f1b7e77f723afebf5f5a4a378ca">endstopsEnabled</a> = en;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordflow">if</span> (en) { <span class="comment">// prevent that an interrupt is triggered immediately in case an endstop happens to be active at the moment</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;              <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].<a class="code" href="struct_stepper.html#a178865b71f7ed8c5b63546fb0b82bb28">prevEndstopState</a> = <a class="code" href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">pollEndstops</a>(unit);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;          }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a74a8b3066bfae0830a9893a0a2121545">endstopsCmd</a>: {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            uint8_t b = <a class="code" href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">pollEndstops</a>(unit);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(b);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a480ddc1e935484c95a4c5a668eff6264">attachCmd</a>: { <span class="comment">//</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;          <span class="comment">//log(&quot;addStepperCmd\n&quot;);</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          <span class="keywordflow">if</span> (i == 6) { <span class="comment">// 5 uint8_t + 1 bool</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            uint8_t interface; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(interface);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            uint8_t pin1; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin1);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            uint8_t pin2; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin2);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            uint8_t pin3; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin3);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            uint8_t pin4; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(pin4);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="keywordtype">bool</span> enable; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(enable);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            int8_t num = <a class="code" href="firmware_8ino.html#ae2a8610cdcfb2697510a8ee83499558e">addStepper</a>(interface, pin1, pin2, pin3, pin4, enable);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(num);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        }</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">         wrapperI2C commands</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_i2_cwrapper_8h.html#acec6e1426fd9aeda1f6ac91c1a0c9669">resetCmd</a>: {</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          <span class="keywordflow">if</span> (i == 0) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n\n---&gt; Resetting\n\n&quot;</span>);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">for</span> (uint8_t j = 0; j &lt; <a class="code" href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a>; j++) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;              <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[j].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;stop();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;              <a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[j].<a class="code" href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">stepper</a>-&gt;disableOutputs();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          Serial.flush();</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          <a class="code" href="firmware_8ino.html#ab45a881cd27fd11dbc87571c6a9cba34">resetFunc</a>();</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_i2_cwrapper_8h.html#af646fa595f938094f40752157facec6f">changeI2CaddressCmd</a>: {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="keywordflow">if</span> (i == 1) { <span class="comment">// 1 uint8_t</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            uint8_t <a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(<a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;Storing new Address &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            <a class="code" href="firmware_8ino.html#a04dab60aa1102ee6bfabfc6a039849ee">storeI2C_address</a>(<a class="code" href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a>);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#a1792e9b38880d917e9ef18a384f79b9b">enableDiagnosticsCmd</a>: {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          <span class="keywordflow">if</span> (i == 1) { <span class="comment">// 1 bool</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(diagnosticsEnabled);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;          }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#ac40bdeccbbd41e5714c84a8fb682e376">diagnosticsCmd</a>: {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          <span class="keywordflow">if</span> (i == 0) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            currentDiagnostics.<a class="code" href="structdiagnostics_report.html#a14178ad9926d73c00aae6db42daacdd5">cycles</a> = <a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(currentDiagnostics);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <a class="code" href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a> = 0;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_i2_cwrapper_8h.html#a4be191ea24212a9d3b4bcbc37ad3fdad">setInterruptPinCmd</a>: {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          <span class="keywordflow">if</span> (i == 2) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(<a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a>);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(<a class="code" href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">interruptActiveHigh</a>);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            pinMode(<a class="code" href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a>, OUTPUT);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            <a class="code" href="firmware_8ino.html#adebb2a389a701d95bb721df60053bf6c">clearInterrupt</a>();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;          }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_i2_cwrapper_8h.html#a0b6e031fe549779b080ca6e6cd18728a">clearInterruptCmd</a>: {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          <span class="keywordflow">if</span> (i == 0) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <a class="code" href="firmware_8ino.html#adebb2a389a701d95bb721df60053bf6c">clearInterrupt</a>(); <span class="comment">// reset pin state</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(uint8_t(<a class="code" href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">interruptReason</a> &lt;&lt; 4 | <a class="code" href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">interruptSource</a>));</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <a class="code" href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">interruptSource</a> = 0xF;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <a class="code" href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">interruptReason</a> = 0xF;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_accel_stepper_i2_c_8h.html#aaac41c0c9f194788cd88d129fb950fde">enableInterruptsCmd</a>: { <span class="comment">//</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a>(unit) and (i == 1)) { <span class="comment">// 1 bool</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(<a class="code" href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a>[unit].interruptsEnabled);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;          }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_i2_cwrapper_8h.html#a9f0a79634b5f528ad35ef71e14b7a515">getVersionCmd</a>: {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;          <span class="keywordflow">if</span> (i == 0) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="version_8h.html#ae9175e671a844995c3b1474ff2341a03">VersionPatch</a>);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="version_8h.html#af4071954c3e1aa6709a2ffff0ce9bc05">VersionMinor</a>);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="version_8h.html#a18005e714d083d578e7471e9a3dc5355">VersionMajor</a>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;          }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">#if defined(SERVO_SUPPORT)</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="comment">// servo implementation is dumb. It passes each command over I2C even if only some of the commands actually do something slave related. It would be much smarter to let the master do commands like attached() without I2C traffic. The dumb way however is easier and safer.</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#aec2445532cf01327e2361b2e8d1f8e39">servoAttach1Cmd</a>: {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;          <span class="keywordflow">if</span> ((<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a> &lt; <a class="code" href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">maxServos</a>) and (i == 2)) { <span class="comment">// 1 int</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="keywordtype">int</span> p; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(p);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>].attach(p);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>++);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;          }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#ad184b5d78fd4f16b77fd4e600225d4c2">servoAttach2Cmd</a>: {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;          <span class="keywordflow">if</span> ((<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a> &lt; <a class="code" href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">maxServos</a>) and (i == 6)) { <span class="comment">// 3 int</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordtype">int</span> p; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(p);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keywordtype">int</span> min; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(min);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordtype">int</span> max; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(max);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>].attach(p, min, max);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a>++);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#acdcf8e912dfca4c7b876bda6c91e691f">servoDetachCmd</a>: {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].detach();</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;          }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#ad6ec5d5c7cec42dab211c442066ced31">servoWriteCmd</a>: {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 2)) { <span class="comment">// 1 int</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordtype">int</span> value; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(value);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].write(value);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;          }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#a640ecab1a6502f0435e993a0b68b0619">servoWriteMicrosecondsCmd</a>: {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 2)) { <span class="comment">// 1 int</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="keywordtype">int</span> value; <a class="code" href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a>-&gt;<a class="code" href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">read</a>(value);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            <a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].writeMicroseconds(value);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;          }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#a06400364c4fd99d2fd97802201e5640e">servoReadCmd</a>: {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].read());</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;          }</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#ac57405b05b7fb9d6bb5c876a506bb20e">servoReadMicrosecondsCmd</a>: {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].readMicroseconds());</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="_servo_i2_c_8h.html#ad8b62d49f383d27b1ee493d97bf9cc97">servoAttachedCmd</a>: {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a>(unit) and (i == 0)) { <span class="comment">// no parameters</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">write</a>(<a class="code" href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a>[unit].attached());</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="preprocessor">#endif // defined(SERVO_SUPPORT)</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;No matching command found&quot;</span>);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    } <span class="comment">// switch</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a> &gt; 1) {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;Output buffer after processing (&quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; bytes): &quot;</span>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>; i++) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i]);  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    } <span class="comment">// if (bufferOut-&gt;idx &gt; 1)</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor">#ifdef ESP32</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// ESP32 slave implementation needs the I2C-reply buffer prefilled. I.e. onRequest() will, without our own doing,</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">// just send what&#39;s in the I2C buffer at the time of the request, and anything that&#39;s written during the request</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="comment">// will only be sent in the next request cycle. So let&#39;s prefill the buffer here.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="comment">// ### what exactly is the role of slaveWrite() vs. Write(), here?</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="comment">// ### slaveWrite() is only for ESP32, not for it&#39;s poorer cousins ESP32-S2 and ESP32-C3. Need to fine tune the compiler directive, here?</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="firmware_8ino.html#a0a7a32f4b61eba1d8e3a7b402abf733b">writeOutputBuffer</a>();</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">#endif  // ESP32</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="comment">//    } // if valid s</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  } <span class="comment">// if (bufferIn-&gt;checkCRC8())</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  currentDiagnostics.<a class="code" href="structdiagnostics_report.html#a6f4f501a700f2cd94c209267c4d99c09">lastProcessTime</a> = micros() - thenMicrosP;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;}</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">// If there is anything in the output buffer, write it out to I2C.</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">// This is outdourced to a function, as, depending on the architecture,</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">// it is called either directly from the interrupt (AVR) or from</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">// message processing (ESP32).</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"><a class="line" href="firmware_8ino.html#a0a7a32f4b61eba1d8e3a7b402abf733b"> 1046</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#a0a7a32f4b61eba1d8e3a7b402abf733b">writeOutputBuffer</a>()</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a> &gt; 1) {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a4df34a56ad455801e52c7524ec48d8d3">setCRC8</a>();</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="preprocessor">#ifdef ESP32</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    Wire.slaveWrite(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>, <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    Wire.write(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>, <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor">#endif  // ESP32</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160; </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="comment">// for AVRs logging to Serial will happen in an interrupt - not recommenended but seems to work</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;sent &quot;</span>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>); <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; bytes: &quot;</span>);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>; i++) {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">buffer</a>[i]);  <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <a class="code" href="firmware_8ino.html#ab2458d18375b44e68abd4672fe965562">writtenToBuffer</a> = <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">idx</a>; <span class="comment">// remember this (for ESP32) to signal main loop later that we sent buffer</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <a class="code" href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a>-&gt;<a class="code" href="class_simple_buffer.html#a0408a7143a40a819685a2de0ae16bcb3">reset</a>();  <span class="comment">// never send anything twice</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;}</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor">#if defined(ESP8266)</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;ICACHE_RAM_ATTR</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"><a class="line" href="firmware_8ino.html#ac10b80b8aaeaf66cecbf0bb5eff5ae33"> 1086</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="firmware_8ino.html#ac10b80b8aaeaf66cecbf0bb5eff5ae33">requestEvent</a>()</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;{</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  thenMicros = micros();</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="preprocessor">#ifndef ESP32</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <a class="code" href="firmware_8ino.html#a0a7a32f4b61eba1d8e3a7b402abf733b">writeOutputBuffer</a>();</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#endif // not ESP32</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <a class="code" href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a> = <a class="code" href="firmware_8ino.html#ab2458d18375b44e68abd4672fe965562">writtenToBuffer</a>; <span class="comment">// signal main loop that we sent buffer contents</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="preprocessor">#endif // DEBUG</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="preprocessor">#ifdef DIAGNOSTICS</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  currentDiagnostics.<a class="code" href="structdiagnostics_report.html#a76febbd4a8a6a8577dd7da70a81febcd">lastRequestTime</a> = micros() - thenMicros;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="preprocessor">#endif // DIAGNOSTICS</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_ac40bdeccbbd41e5714c84a8fb682e376"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#ac40bdeccbbd41e5714c84a8fb682e376">diagnosticsCmd</a></div><div class="ttdeci">const uint8_t diagnosticsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00123">AccelStepperI2C.h:123</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a9ffc376a015a72bacc0fa343e6fd7dd5"><div class="ttname"><a href="firmware_8ino.html#a9ffc376a015a72bacc0fa343e6fd7dd5">numSteppers</a></div><div class="ttdeci">uint8_t numSteppers</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00231">firmware.ino:231</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_a640ecab1a6502f0435e993a0b68b0619"><div class="ttname"><a href="_servo_i2_c_8h.html#a640ecab1a6502f0435e993a0b68b0619">servoWriteMicrosecondsCmd</a></div><div class="ttdeci">const uint8_t servoWriteMicrosecondsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00042">ServoI2C.h:42</a></div></div>
<div class="ttc" id="afirmware_8ino_html_affd9824af02dde7126d00d43a74c0081"><div class="ttname"><a href="firmware_8ino.html#affd9824af02dde7126d00d43a74c0081">newMessage</a></div><div class="ttdeci">volatile uint8_t newMessage</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00140">firmware.ino:140</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a84c7d8262a16efd1f7619fd8978bc89f"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a84c7d8262a16efd1f7619fd8978bc89f">moveToCmd</a></div><div class="ttdeci">const uint8_t moveToCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00094">AccelStepperI2C.h:94</a></div></div>
<div class="ttc" id="agroup___interrupt_reasons_html_ga95cdb0448ea51cc3ea41bc96e96f59dc"><div class="ttname"><a href="group___interrupt_reasons.html#ga95cdb0448ea51cc3ea41bc96e96f59dc">interruptReason_endstopHit</a></div><div class="ttdeci">const uint8_t interruptReason_endstopHit</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00144">AccelStepperI2C.h:144</a></div></div>
<div class="ttc" id="aversion_8h_html_af4071954c3e1aa6709a2ffff0ce9bc05"><div class="ttname"><a href="version_8h.html#af4071954c3e1aa6709a2ffff0ce9bc05">VersionMinor</a></div><div class="ttdeci">const uint8_t VersionMinor</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00005">version.h:5</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a3bbebd6c8b4bd27f6a93cd6d7d15b296"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a3bbebd6c8b4bd27f6a93cd6d7d15b296">state_runSpeed</a></div><div class="ttdeci">const uint8_t state_runSpeed</div><div class="ttdoc">corresponds to AccelStepper::runSpeed(), will remain active until stopped by user or endstop</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00135">AccelStepperI2C.h:135</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a1f4c45d7bdeb39248284aff560efba37"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a1f4c45d7bdeb39248284aff560efba37">setMinPulseWidthCmd</a></div><div class="ttdeci">const uint8_t setMinPulseWidthCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00113">AccelStepperI2C.h:113</a></div></div>
<div class="ttc" id="agroup___interrupt_reasons_html_ga69a3d7d4ea76a6171ea62f657aa6aa90"><div class="ttname"><a href="group___interrupt_reasons.html#ga69a3d7d4ea76a6171ea62f657aa6aa90">interruptReason_targetReachedByRunSpeedToPosition</a></div><div class="ttdeci">const uint8_t interruptReason_targetReachedByRunSpeedToPosition</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00143">AccelStepperI2C.h:143</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4e882aeffdf111848ef1647b42fe1dde"><div class="ttname"><a href="firmware_8ino.html#a4e882aeffdf111848ef1647b42fe1dde">reportNow</a></div><div class="ttdeci">bool reportNow</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00103">firmware.ino:103</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_ab6da5e42caa09167ae7c403ab66d53b8"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#ab6da5e42caa09167ae7c403ab66d53b8">runToNewPositionCmd</a></div><div class="ttdeci">const uint8_t runToNewPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00109">AccelStepperI2C.h:109</a></div></div>
<div class="ttc" id="afirmware_8ino_html_acee4f8c66bd06079db7157d155550ede"><div class="ttname"><a href="firmware_8ino.html#acee4f8c66bd06079db7157d155550ede">lastCycles</a></div><div class="ttdeci">uint32_t lastCycles</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00104">firmware.ino:104</a></div></div>
<div class="ttc" id="astruct_stepper_html"><div class="ttname"><a href="struct_stepper.html">Stepper</a></div><div class="ttdoc">This struct comprises all stepper parameters needed for local slave management.</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00236">firmware.ino:236</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a8633d2064ee1822248523a0c402920e3"><div class="ttname"><a href="firmware_8ino.html#a8633d2064ee1822248523a0c402920e3">eepromI2CaddressMarker</a></div><div class="ttdeci">const uint32_t eepromI2CaddressMarker</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00128">firmware.ino:128</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_acdcf8e912dfca4c7b876bda6c91e691f"><div class="ttname"><a href="_servo_i2_c_8h.html#acdcf8e912dfca4c7b876bda6c91e691f">servoDetachCmd</a></div><div class="ttdeci">const uint8_t servoDetachCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00040">ServoI2C.h:40</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a0a7a32f4b61eba1d8e3a7b402abf733b"><div class="ttname"><a href="firmware_8ino.html#a0a7a32f4b61eba1d8e3a7b402abf733b">writeOutputBuffer</a></div><div class="ttdeci">void writeOutputBuffer()</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l01046">firmware.ino:1046</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a8bd4f1641834c3100eee45ba9df22ad8"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a8bd4f1641834c3100eee45ba9df22ad8">speedCmd</a></div><div class="ttdeci">const uint8_t speedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00102">AccelStepperI2C.h:102</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a65d7f026e933ce3930c0f50e07c29236"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a65d7f026e933ce3930c0f50e07c29236">isRunningCmd</a></div><div class="ttdeci">const uint8_t isRunningCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00117">AccelStepperI2C.h:117</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a4df34a56ad455801e52c7524ec48d8d3"><div class="ttname"><a href="class_simple_buffer.html#a4df34a56ad455801e52c7524ec48d8d3">SimpleBuffer::setCRC8</a></div><div class="ttdeci">void setCRC8()</div><div class="ttdoc">Calculate CRC8 checksum for the currently used buffer ([1]...[idx-1]) and store it in the first byte ...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8cpp_source.html#l00049">SimpleBuffer.cpp:49</a></div></div>
<div class="ttc" id="astruct_stepper_html_ae36f45db777f7ea1c40c91b74ff848ac"><div class="ttname"><a href="struct_stepper.html#ae36f45db777f7ea1c40c91b74ff848ac">Stepper::stepper</a></div><div class="ttdeci">AccelStepper * stepper</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00238">firmware.ino:238</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a1dc7abae7acd49723430005dcd7ab563"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a1dc7abae7acd49723430005dcd7ab563">runSpeedCmd</a></div><div class="ttdeci">const uint8_t runSpeedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00097">AccelStepperI2C.h:97</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a701b5c3b5816e355a8cec77d581ac415"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a701b5c3b5816e355a8cec77d581ac415">stopCmd</a></div><div class="ttdeci">const uint8_t stopCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00110">AccelStepperI2C.h:110</a></div></div>
<div class="ttc" id="astructdiagnostics_report_html_a14178ad9926d73c00aae6db42daacdd5"><div class="ttname"><a href="structdiagnostics_report.html#a14178ad9926d73c00aae6db42daacdd5">diagnosticsReport::cycles</a></div><div class="ttdeci">uint32_t cycles</div><div class="ttdoc">Number of slave's main loop executions since the last reboot.</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00087">AccelStepperI2C.h:87</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a1792e9b38880d917e9ef18a384f79b9b"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a1792e9b38880d917e9ef18a384f79b9b">enableDiagnosticsCmd</a></div><div class="ttdeci">const uint8_t enableDiagnosticsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00122">AccelStepperI2C.h:122</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ab2458d18375b44e68abd4672fe965562"><div class="ttname"><a href="firmware_8ino.html#ab2458d18375b44e68abd4672fe965562">writtenToBuffer</a></div><div class="ttdeci">volatile uint8_t writtenToBuffer</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00095">firmware.ino:95</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a1d50a416712971c3f761558f04ce26b1"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a1d50a416712971c3f761558f04ce26b1">disableOutputsCmd</a></div><div class="ttdeci">const uint8_t disableOutputsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00111">AccelStepperI2C.h:111</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a1c32cae8a445215aa333609cef8b7b11"><div class="ttname"><a href="class_simple_buffer.html#a1c32cae8a445215aa333609cef8b7b11">SimpleBuffer::checkCRC8</a></div><div class="ttdeci">bool checkCRC8()</div><div class="ttdoc">Check for correct CRC8 checksum. First byte [0] holds the checksum, rest of the currently used buffer...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8cpp_source.html#l00054">SimpleBuffer.cpp:54</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ad2a5acb9b13b943cac9ef0b8c8370100"><div class="ttname"><a href="firmware_8ino.html#ad2a5acb9b13b943cac9ef0b8c8370100">now</a></div><div class="ttdeci">uint32_t now</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00102">firmware.ino:102</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html"><div class="ttname"><a href="class_simple_buffer.html">SimpleBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8h_source.html#l00030">SimpleBuffer.h:30</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a6aee218a8369544c588e6a1738d0ef5b"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a6aee218a8369544c588e6a1738d0ef5b">setMaxSpeedCmd</a></div><div class="ttdeci">const uint8_t setMaxSpeedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00098">AccelStepperI2C.h:98</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_aaac41c0c9f194788cd88d129fb950fde"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#aaac41c0c9f194788cd88d129fb950fde">enableInterruptsCmd</a></div><div class="ttdeci">const uint8_t enableInterruptsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00124">AccelStepperI2C.h:124</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_ac57405b05b7fb9d6bb5c876a506bb20e"><div class="ttname"><a href="_servo_i2_c_8h.html#ac57405b05b7fb9d6bb5c876a506bb20e">servoReadMicrosecondsCmd</a></div><div class="ttdeci">const uint8_t servoReadMicrosecondsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00044">ServoI2C.h:44</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a82c2dca294e6df8a284651b486985d11"><div class="ttname"><a href="firmware_8ino.html#a82c2dca294e6df8a284651b486985d11">endstopDebouncePeriod</a></div><div class="ttdeci">const uint32_t endstopDebouncePeriod</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00224">firmware.ino:224</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_afafaa62910a60220ce0b83ecfed27e43"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#afafaa62910a60220ce0b83ecfed27e43">AccelStepperI2CmaxBuf</a></div><div class="ttdeci">const uint8_t AccelStepperI2CmaxBuf</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00075">AccelStepperI2C.h:75</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a75da675711616279a4bbd6797d4d0342"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a75da675711616279a4bbd6797d4d0342">currentPositionCmd</a></div><div class="ttdeci">const uint8_t currentPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00105">AccelStepperI2C.h:105</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a9680ed198edfb3f90bca8896549ab3e4"><div class="ttname"><a href="class_simple_buffer.html#a9680ed198edfb3f90bca8896549ab3e4">SimpleBuffer::read</a></div><div class="ttdeci">void read(T &amp;value)</div><div class="ttdoc">Read any basic data type from the buffer from the current position and increment the position pointer...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8h_source.html#l00112">SimpleBuffer.h:112</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a7658032e03469b7a54542145f6d59bc6"><div class="ttname"><a href="firmware_8ino.html#a7658032e03469b7a54542145f6d59bc6">steppers</a></div><div class="ttdeci">Stepper steppers[maxSteppers]</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00247">firmware.ino:247</a></div></div>
<div class="ttc" id="astruct_endstop_html_a2eed94b6d3cb330c1c3f92bdc6a96f87"><div class="ttname"><a href="struct_endstop.html#a2eed94b6d3cb330c1c3f92bdc6a96f87">Endstop::pin</a></div><div class="ttdeci">uint8_t pin</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00219">firmware.ino:219</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_a06400364c4fd99d2fd97802201e5640e"><div class="ttname"><a href="_servo_i2_c_8h.html#a06400364c4fd99d2fd97802201e5640e">servoReadCmd</a></div><div class="ttdeci">const uint8_t servoReadCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00043">ServoI2C.h:43</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_ad184b5d78fd4f16b77fd4e600225d4c2"><div class="ttname"><a href="_servo_i2_c_8h.html#ad184b5d78fd4f16b77fd4e600225d4c2">servoAttach2Cmd</a></div><div class="ttdeci">const uint8_t servoAttach2Cmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00039">ServoI2C.h:39</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a72a38b8d17ee1e47de4099a71e6a13b4"><div class="ttname"><a href="firmware_8ino.html#a72a38b8d17ee1e47de4099a71e6a13b4">servos</a></div><div class="ttdeci">Servo servos[maxServos]</div><div class="ttdoc">Uncomment this to enable time keeping diagnostics. You probably should disable debugging,...</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00084">firmware.ino:84</a></div></div>
<div class="ttc" id="astruct_stepper_html_a24eae51605c18f17f05833a2061f7ab1"><div class="ttname"><a href="struct_stepper.html#a24eae51605c18f17f05833a2061f7ab1">Stepper::numEndstops</a></div><div class="ttdeci">uint8_t numEndstops</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00241">firmware.ino:241</a></div></div>
<div class="ttc" id="a_i2_cwrapper_8h_html_af646fa595f938094f40752157facec6f"><div class="ttname"><a href="_i2_cwrapper_8h.html#af646fa595f938094f40752157facec6f">changeI2CaddressCmd</a></div><div class="ttdeci">const uint8_t changeI2CaddressCmd</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00039">I2Cwrapper.h:39</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ab45a881cd27fd11dbc87571c6a9cba34"><div class="ttname"><a href="firmware_8ino.html#ab45a881cd27fd11dbc87571c6a9cba34">resetFunc</a></div><div class="ttdeci">void resetFunc()</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00254">firmware.ino:254</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html">AccelStepperI2C.h</a></div></div>
<div class="ttc" id="a_i2_cwrapper_8h_html_a4be191ea24212a9d3b4bcbc37ad3fdad"><div class="ttname"><a href="_i2_cwrapper_8h.html#a4be191ea24212a9d3b4bcbc37ad3fdad">setInterruptPinCmd</a></div><div class="ttdeci">const uint8_t setInterruptPinCmd</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00040">I2Cwrapper.h:40</a></div></div>
<div class="ttc" id="afirmware_8ino_html_adebb2a389a701d95bb721df60053bf6c"><div class="ttname"><a href="firmware_8ino.html#adebb2a389a701d95bb721df60053bf6c">clearInterrupt</a></div><div class="ttdeci">void clearInterrupt()</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00358">firmware.ino:358</a></div></div>
<div class="ttc" id="astructdiagnostics_report_html_a6f4f501a700f2cd94c209267c4d99c09"><div class="ttname"><a href="structdiagnostics_report.html#a6f4f501a700f2cd94c209267c4d99c09">diagnosticsReport::lastProcessTime</a></div><div class="ttdeci">uint16_t lastProcessTime</div><div class="ttdoc">microseconds the slave needed to process (interpret) most recently received command</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00088">AccelStepperI2C.h:88</a></div></div>
<div class="ttc" id="afirmware_8ino_html_af9405df89f8c78a1f50085b10911ca37"><div class="ttname"><a href="firmware_8ino.html#af9405df89f8c78a1f50085b10911ca37">cycles</a></div><div class="ttdeci">uint32_t cycles</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00120">firmware.ino:120</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a7ae740ae99dd4da7bdbe1d7245d85097"><div class="ttname"><a href="class_simple_buffer.html#a7ae740ae99dd4da7bdbe1d7245d85097">SimpleBuffer::idx</a></div><div class="ttdeci">uint8_t idx</div><div class="ttdoc">The position pointer. Remember, [0] holds the CRC8 checksum, so for an empty buffer,...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8h_source.html#l00090">SimpleBuffer.h:90</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a56ff022c8c9a6539accc3b6fa4f7efb8"><div class="ttname"><a href="firmware_8ino.html#a56ff022c8c9a6539accc3b6fa4f7efb8">validStepper</a></div><div class="ttdeci">bool validStepper(int8_t s)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00520">firmware.ino:520</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a1cad4e2514f451585f15da3b8ee3cd2f"><div class="ttname"><a href="firmware_8ino.html#a1cad4e2514f451585f15da3b8ee3cd2f">EEPROM_OFFSET_I2C_ADDRESS</a></div><div class="ttdeci">#define EEPROM_OFFSET_I2C_ADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00127">firmware.ino:127</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a3537c8d1234ff7b177af8fad522cc948"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a3537c8d1234ff7b177af8fad522cc948">setPinsInverted1Cmd</a></div><div class="ttdeci">const uint8_t setPinsInverted1Cmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00115">AccelStepperI2C.h:115</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a3dc3b1bfb8fa250b49a70c77e11e87c2"><div class="ttname"><a href="firmware_8ino.html#a3dc3b1bfb8fa250b49a70c77e11e87c2">interruptSource</a></div><div class="ttdeci">uint8_t interruptSource</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00210">firmware.ino:210</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a60eef344c72bf4ef956d52dbc71e575e"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a60eef344c72bf4ef956d52dbc71e575e">state_run</a></div><div class="ttdeci">const uint8_t state_run</div><div class="ttdoc">corresponds to AccelStepper::run(), will fall back to state_stopped if target reached or endstop hit</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00134">AccelStepperI2C.h:134</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a0b114f5865a1a8fa4461a70a3e76ee07"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a0b114f5865a1a8fa4461a70a3e76ee07">getStateCmd</a></div><div class="ttdeci">const uint8_t getStateCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00126">AccelStepperI2C.h:126</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a8270206122d7d60c6447798625bec3c5"><div class="ttname"><a href="firmware_8ino.html#a8270206122d7d60c6447798625bec3c5">numServos</a></div><div class="ttdeci">uint8_t numServos</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00085">firmware.ino:85</a></div></div>
<div class="ttc" id="afirmware_8ino_html_aa84ea5f47409c6c60bc911ba4bc06fb0"><div class="ttname"><a href="firmware_8ino.html#aa84ea5f47409c6c60bc911ba4bc06fb0">maxEndstops</a></div><div class="ttdeci">const uint8_t maxEndstops</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00223">firmware.ino:223</a></div></div>
<div class="ttc" id="astruct_stepper_html_aafb876574872c4278bd330a60cdefc4a"><div class="ttname"><a href="struct_stepper.html#aafb876574872c4278bd330a60cdefc4a">Stepper::interruptsEnabled</a></div><div class="ttdeci">bool interruptsEnabled</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00242">firmware.ino:242</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a105a8a1e3441e35a9c6cf7ff03cf47d5"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a105a8a1e3441e35a9c6cf7ff03cf47d5">setEnablePinCmd</a></div><div class="ttdeci">const uint8_t setEnablePinCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00114">AccelStepperI2C.h:114</a></div></div>
<div class="ttc" id="afirmware_8ino_html_aab25d82c1087f38c24fedd257e192278"><div class="ttname"><a href="firmware_8ino.html#aab25d82c1087f38c24fedd257e192278">reportPeriod</a></div><div class="ttdeci">const uint32_t reportPeriod</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00105">firmware.ino:105</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a04dab60aa1102ee6bfabfc6a039849ee"><div class="ttname"><a href="firmware_8ino.html#a04dab60aa1102ee6bfabfc6a039849ee">storeI2C_address</a></div><div class="ttdeci">void storeI2C_address(uint8_t newAddress)</div><div class="ttdoc">Write I2C address to EEPROM.</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00178">firmware.ino:178</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a4fe86d8150428e236dd5958662da1b94"><div class="ttname"><a href="class_simple_buffer.html#a4fe86d8150428e236dd5958662da1b94">SimpleBuffer::init</a></div><div class="ttdeci">void init(uint8_t buflen)</div><div class="ttdoc">Allocate and reset buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8cpp_source.html#l00016">SimpleBuffer.cpp:16</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a480ddc1e935484c95a4c5a668eff6264"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a480ddc1e935484c95a4c5a668eff6264">attachCmd</a></div><div class="ttdeci">const uint8_t attachCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00121">AccelStepperI2C.h:121</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a2451a9b021bbbd6931ff9832f662af13"><div class="ttname"><a href="firmware_8ino.html#a2451a9b021bbbd6931ff9832f662af13">interruptReason</a></div><div class="ttdeci">uint8_t interruptReason</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00211">firmware.ino:211</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a6335b7c0e0151e1f0fca222235cb4ee0"><div class="ttname"><a href="firmware_8ino.html#a6335b7c0e0151e1f0fca222235cb4ee0">slaveDefaultAddress</a></div><div class="ttdeci">const uint8_t slaveDefaultAddress</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00042">firmware.ino:42</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_ac67d1b7ccff8a2bc120abe262b738b57"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#ac67d1b7ccff8a2bc120abe262b738b57">setAccelerationCmd</a></div><div class="ttdeci">const uint8_t setAccelerationCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00100">AccelStepperI2C.h:100</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a0408a7143a40a819685a2de0ae16bcb3"><div class="ttname"><a href="class_simple_buffer.html#a0408a7143a40a819685a2de0ae16bcb3">SimpleBuffer::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">Reset the position pointer to the start of the buffer (which is[1] as [0] is the CRC8 chcksum) withou...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8cpp_source.html#l00023">SimpleBuffer.cpp:23</a></div></div>
<div class="ttc" id="afirmware_8ino_html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="firmware_8ino.html#afe461d27b9c48d5921c00d521181f12f">loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Main loop, implements the state machine. Will check for each stepper's state and do the appropriate p...</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00376">firmware.ino:376</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a5bc0135fc6c2b403837faaef6ab7c638"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a5bc0135fc6c2b403837faaef6ab7c638">moveCmd</a></div><div class="ttdeci">const uint8_t moveCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00095">AccelStepperI2C.h:95</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_ac5a577b7b05194baa66adb3e5a00d4ee"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#ac5a577b7b05194baa66adb3e5a00d4ee">runCmd</a></div><div class="ttdeci">const uint8_t runCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00096">AccelStepperI2C.h:96</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_abbb5564cfde6eb726771ee16e25d86db"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#abbb5564cfde6eb726771ee16e25d86db">setPinsInverted2Cmd</a></div><div class="ttdeci">const uint8_t setPinsInverted2Cmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00116">AccelStepperI2C.h:116</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_adaf29ee0d70159646b34b11c4dd7b193"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#adaf29ee0d70159646b34b11c4dd7b193">setCurrentPositionCmd</a></div><div class="ttdeci">const uint8_t setCurrentPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00106">AccelStepperI2C.h:106</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a73b31c4c5b4a3d32085fa1570594ac64"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a73b31c4c5b4a3d32085fa1570594ac64">state_stopped</a></div><div class="ttdeci">const uint8_t state_stopped</div><div class="ttdoc">stepper state machine states</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00133">AccelStepperI2C.h:133</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a0f9813196df1c36828566b98fb497cd7"><div class="ttname"><a href="firmware_8ino.html#a0f9813196df1c36828566b98fb497cd7">maxServos</a></div><div class="ttdeci">const uint8_t maxServos</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00049">firmware.ino:49</a></div></div>
<div class="ttc" id="a_i2_cwrapper_8h_html_acec6e1426fd9aeda1f6ac91c1a0c9669"><div class="ttname"><a href="_i2_cwrapper_8h.html#acec6e1426fd9aeda1f6ac91c1a0c9669">resetCmd</a></div><div class="ttdeci">const uint8_t resetCmd</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00038">I2Cwrapper.h:38</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a66726e5f1a55e7253ddd5aeec06f19c3"><div class="ttname"><a href="firmware_8ino.html#a66726e5f1a55e7253ddd5aeec06f19c3">log</a></div><div class="ttdeci">#define log(...)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00094">firmware.ino:94</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a570420b17131e93d2c3ff7665f121800"><div class="ttname"><a href="firmware_8ino.html#a570420b17131e93d2c3ff7665f121800">then</a></div><div class="ttdeci">uint32_t then</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00102">firmware.ino:102</a></div></div>
<div class="ttc" id="astruct_stepper_html_a2b4137230f8c24b169d447231de2c14c"><div class="ttname"><a href="struct_stepper.html#a2b4137230f8c24b169d447231de2c14c">Stepper::endstops</a></div><div class="ttdeci">Endstop endstops[maxEndstops]</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00240">firmware.ino:240</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4906408a38ad9d4f1bca763aa75422ad"><div class="ttname"><a href="firmware_8ino.html#a4906408a38ad9d4f1bca763aa75422ad">processMessage</a></div><div class="ttdeci">void processMessage(uint8_t len)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00549">firmware.ino:549</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ab1764b48f3cc3657deeb69208ad55cb1"><div class="ttname"><a href="firmware_8ino.html#ab1764b48f3cc3657deeb69208ad55cb1">interruptActiveHigh</a></div><div class="ttdeci">bool interruptActiveHigh</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00209">firmware.ino:209</a></div></div>
<div class="ttc" id="astructdiagnostics_report_html"><div class="ttname"><a href="structdiagnostics_report.html">diagnosticsReport</a></div><div class="ttdoc">Used to transmit diagnostic info with AccelStepperI2C::diagnostics().</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00085">AccelStepperI2C.h:85</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a74a8b3066bfae0830a9893a0a2121545"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a74a8b3066bfae0830a9893a0a2121545">endstopsCmd</a></div><div class="ttdeci">const uint8_t endstopsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00129">AccelStepperI2C.h:129</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a4b583eb01c6dd23a01f556d9164f9dfc"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a4b583eb01c6dd23a01f556d9164f9dfc">setEndstopPinCmd</a></div><div class="ttdeci">const uint8_t setEndstopPinCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00127">AccelStepperI2C.h:127</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a8533b53e7a9817dd082d33d58f095826"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a8533b53e7a9817dd082d33d58f095826">distanceToGoCmd</a></div><div class="ttdeci">const uint8_t distanceToGoCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00103">AccelStepperI2C.h:103</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a377a90b916ad4433650793b43e74f9a4"><div class="ttname"><a href="firmware_8ino.html#a377a90b916ad4433650793b43e74f9a4">pollEndstops</a></div><div class="ttdeci">uint8_t pollEndstops(uint8_t s)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00330">firmware.ino:330</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_adb260163a19a3ecc78a1d8bd022ee4b7"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#adb260163a19a3ecc78a1d8bd022ee4b7">maxSpeedCmd</a></div><div class="ttdeci">const uint8_t maxSpeedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00099">AccelStepperI2C.h:99</a></div></div>
<div class="ttc" id="astruct_stepper_html_a84037efe9d1722547a3cc36ebdb6b55d"><div class="ttname"><a href="struct_stepper.html#a84037efe9d1722547a3cc36ebdb6b55d">Stepper::endstopDebounceEnd</a></div><div class="ttdeci">uint32_t endstopDebounceEnd</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00245">firmware.ino:245</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a33b3a368a4769f3e1ef4c7b7e5e4ec32"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a33b3a368a4769f3e1ef4c7b7e5e4ec32">state_runSpeedToPosition</a></div><div class="ttdeci">const uint8_t state_runSpeedToPosition</div><div class="ttdoc">corresponds to AccelStepper::state_runSpeedToPosition(), will fall back to state_stopped if target po...</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00136">AccelStepperI2C.h:136</a></div></div>
<div class="ttc" id="astruct_endstop_html"><div class="ttname"><a href="struct_endstop.html">Endstop</a></div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00217">firmware.ino:217</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a9a52aa0319b0d3bea95eff4528baee98"><div class="ttname"><a href="firmware_8ino.html#a9a52aa0319b0d3bea95eff4528baee98">receiveEvent</a></div><div class="ttdeci">void receiveEvent(int howMany)</div><div class="ttdoc">Handle I2C receive event. Just read the message and inform main loop.</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00490">firmware.ino:490</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html"><div class="ttname"><a href="_servo_i2_c_8h.html">ServoI2C.h</a></div><div class="ttdoc">Arduino library for I2C-control of servo motors connected to another Arduino which runs the associate...</div></div>
<div class="ttc" id="astruct_endstop_html_a62dca12651ef2c7a1b20ba9fd1df4146"><div class="ttname"><a href="struct_endstop.html#a62dca12651ef2c7a1b20ba9fd1df4146">Endstop::activeLow</a></div><div class="ttdeci">bool activeLow</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00220">firmware.ino:220</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_aaf459ccf307b8b26517bd3d16ccbd288"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#aaf459ccf307b8b26517bd3d16ccbd288">targetPositionCmd</a></div><div class="ttdeci">const uint8_t targetPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00104">AccelStepperI2C.h:104</a></div></div>
<div class="ttc" id="a_simple_buffer_8h_html"><div class="ttname"><a href="_simple_buffer_8h.html">SimpleBuffer.h</a></div><div class="ttdoc">Simple and ugly serialization buffer for any data type. Template technique and CRC8 adapted from Nick...</div></div>
<div class="ttc" id="agroup___interrupt_reasons_html_ga1f90e0f512487244a9afb99cac141660"><div class="ttname"><a href="group___interrupt_reasons.html#ga1f90e0f512487244a9afb99cac141660">interruptReason_none</a></div><div class="ttdeci">const uint8_t interruptReason_none</div><div class="ttdoc">You should not encounter this, as you don't want to be interrupted without a reason....</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00053">I2Cwrapper.h:53</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a6e2496370a11671546a817ef5b8a2aae"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a6e2496370a11671546a817ef5b8a2aae">enableOutputsCmd</a></div><div class="ttdeci">const uint8_t enableOutputsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00112">AccelStepperI2C.h:112</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a9eca28b463b5850006c7d00aa43a2498"><div class="ttname"><a href="firmware_8ino.html#a9eca28b463b5850006c7d00aa43a2498">bufferIn</a></div><div class="ttdeci">SimpleBuffer * bufferIn</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00138">firmware.ino:138</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4b5902c36f57eccdc4e911f63edcd14b"><div class="ttname"><a href="firmware_8ino.html#a4b5902c36f57eccdc4e911f63edcd14b">maxSteppers</a></div><div class="ttdeci">const uint8_t maxSteppers</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00230">firmware.ino:230</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_ad8b62d49f383d27b1ee493d97bf9cc97"><div class="ttname"><a href="_servo_i2_c_8h.html#ad8b62d49f383d27b1ee493d97bf9cc97">servoAttachedCmd</a></div><div class="ttdeci">const uint8_t servoAttachedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00045">ServoI2C.h:45</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a18927d89764b3c8c70da59bb149524f2"><div class="ttname"><a href="firmware_8ino.html#a18927d89764b3c8c70da59bb149524f2">validServo</a></div><div class="ttdeci">bool validServo(int8_t s)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00525">firmware.ino:525</a></div></div>
<div class="ttc" id="a_change__address_8ino_html_a53811bf61b46bdfb67602aeafbb0b739"><div class="ttname"><a href="_change__address_8ino.html#a53811bf61b46bdfb67602aeafbb0b739">newAddress</a></div><div class="ttdeci">const uint8_t newAddress</div><div class="ttdef"><b>Definition:</b> <a href="_change__address_8ino_source.html#l00017">Change_address.ino:17</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a170d54f56d535f30b6cb09321e89c754"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a170d54f56d535f30b6cb09321e89c754">runToPositionCmd</a></div><div class="ttdeci">const uint8_t runToPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00107">AccelStepperI2C.h:107</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4f3ec17f4d90ce7c4b1714e8e5931452"><div class="ttname"><a href="firmware_8ino.html#a4f3ec17f4d90ce7c4b1714e8e5931452">triggerInterrupt</a></div><div class="ttdeci">void triggerInterrupt(uint8_t source, uint8_t reason)</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00347">firmware.ino:347</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_ac8643e20345fdec2d4ddedfc46dca189"><div class="ttname"><a href="class_simple_buffer.html#ac8643e20345fdec2d4ddedfc46dca189">SimpleBuffer::buffer</a></div><div class="ttdeci">uint8_t * buffer</div><div class="ttdoc">The allocated buffer.</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8h_source.html#l00084">SimpleBuffer.h:84</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_aec2445532cf01327e2361b2e8d1f8e39"><div class="ttname"><a href="_servo_i2_c_8h.html#aec2445532cf01327e2361b2e8d1f8e39">servoAttach1Cmd</a></div><div class="ttdeci">const uint8_t servoAttach1Cmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00038">ServoI2C.h:38</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_ae5db942dd8541e9221efd1efa54d54ec"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#ae5db942dd8541e9221efd1efa54d54ec">setSpeedCmd</a></div><div class="ttdeci">const uint8_t setSpeedCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00101">AccelStepperI2C.h:101</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ac10b80b8aaeaf66cecbf0bb5eff5ae33"><div class="ttname"><a href="firmware_8ino.html#ac10b80b8aaeaf66cecbf0bb5eff5ae33">requestEvent</a></div><div class="ttdeci">void requestEvent()</div><div class="ttdoc">Handle I2C request event. Will send results or information requested by the last command,...</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l01086">firmware.ino:1086</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a3db87eefb7aaa178dba1453ed1ab7b7c"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a3db87eefb7aaa178dba1453ed1ab7b7c">setStateCmd</a></div><div class="ttdeci">const uint8_t setStateCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00125">AccelStepperI2C.h:125</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a6548116a836f7410be00e096b8395ce0"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a6548116a836f7410be00e096b8395ce0">enableEndstopsCmd</a></div><div class="ttdeci">const uint8_t enableEndstopsCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00128">AccelStepperI2C.h:128</a></div></div>
<div class="ttc" id="a_i2_cwrapper_8h_html_a9f0a79634b5f528ad35ef71e14b7a515"><div class="ttname"><a href="_i2_cwrapper_8h.html#a9f0a79634b5f528ad35ef71e14b7a515">getVersionCmd</a></div><div class="ttdeci">const uint8_t getVersionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00042">I2Cwrapper.h:42</a></div></div>
<div class="ttc" id="astructdiagnostics_report_html_a76febbd4a8a6a8577dd7da70a81febcd"><div class="ttname"><a href="structdiagnostics_report.html#a76febbd4a8a6a8577dd7da70a81febcd">diagnosticsReport::lastRequestTime</a></div><div class="ttdeci">uint16_t lastRequestTime</div><div class="ttdoc">microseconds the slave spent in the most recent onRequest() interrupt</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00089">AccelStepperI2C.h:89</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4fc01d736fe50cf5b977f755b675f11d"><div class="ttname"><a href="firmware_8ino.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a></div><div class="ttdeci">void setup()</div><div class="ttdoc">Setup system. Retrieve I2C address from EEPROM or default and initialize I2C slave.</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00276">firmware.ino:276</a></div></div>
<div class="ttc" id="aversion_8h_html_ae9175e671a844995c3b1474ff2341a03"><div class="ttname"><a href="version_8h.html#ae9175e671a844995c3b1474ff2341a03">VersionPatch</a></div><div class="ttdeci">const uint8_t VersionPatch</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00006">version.h:6</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a9d641c48e9eaae758eb0ea69cdbfa9c7"><div class="ttname"><a href="firmware_8ino.html#a9d641c48e9eaae758eb0ea69cdbfa9c7">retrieveI2C_address</a></div><div class="ttdeci">uint8_t retrieveI2C_address()</div><div class="ttdoc">Read a stored I2C address from EEPROM. If there is none, use default.</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00146">firmware.ino:146</a></div></div>
<div class="ttc" id="a_i2_cwrapper_8h_html_a0b6e031fe549779b080ca6e6cd18728a"><div class="ttname"><a href="_i2_cwrapper_8h.html#a0b6e031fe549779b080ca6e6cd18728a">clearInterruptCmd</a></div><div class="ttdeci">const uint8_t clearInterruptCmd</div><div class="ttdef"><b>Definition:</b> <a href="_i2_cwrapper_8h_source.html#l00041">I2Cwrapper.h:41</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a89786b8678479bcf2338a522d43b9381"><div class="ttname"><a href="firmware_8ino.html#a89786b8678479bcf2338a522d43b9381">interruptPin</a></div><div class="ttdeci">int8_t interruptPin</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00208">firmware.ino:208</a></div></div>
<div class="ttc" id="aclass_simple_buffer_html_a6af18ec1c5c082d2a8cefb9468449588"><div class="ttname"><a href="class_simple_buffer.html#a6af18ec1c5c082d2a8cefb9468449588">SimpleBuffer::write</a></div><div class="ttdeci">void write(const T &amp;value)</div><div class="ttdoc">Write any basic data type to the buffer at the current position and increment the position pointer ac...</div><div class="ttdef"><b>Definition:</b> <a href="_simple_buffer_8h_source.html#l00103">SimpleBuffer.h:103</a></div></div>
<div class="ttc" id="astruct_stepper_html_a178865b71f7ed8c5b63546fb0b82bb28"><div class="ttname"><a href="struct_stepper.html#a178865b71f7ed8c5b63546fb0b82bb28">Stepper::prevEndstopState</a></div><div class="ttdeci">uint8_t prevEndstopState</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00244">firmware.ino:244</a></div></div>
<div class="ttc" id="agroup___interrupt_reasons_html_ga73e92a247880625865cb90183f956875"><div class="ttname"><a href="group___interrupt_reasons.html#ga73e92a247880625865cb90183f956875">interruptReason_targetReachedByRun</a></div><div class="ttdeci">const uint8_t interruptReason_targetReachedByRun</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00142">AccelStepperI2C.h:142</a></div></div>
<div class="ttc" id="afirmware_8ino_html_adc3807e20039643a86ced45c531aa952"><div class="ttname"><a href="firmware_8ino.html#adc3807e20039643a86ced45c531aa952">sentOnRequest</a></div><div class="ttdeci">volatile uint8_t sentOnRequest</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00096">firmware.ino:96</a></div></div>
<div class="ttc" id="astruct_stepper_html_abc95f0b832f9d5a671f7afa277bf9c91"><div class="ttname"><a href="struct_stepper.html#abc95f0b832f9d5a671f7afa277bf9c91">Stepper::state</a></div><div class="ttdeci">uint8_t state</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00239">firmware.ino:239</a></div></div>
<div class="ttc" id="a_accel_stepper_i2_c_8h_html_a7df5712fcf7469a487b493f4f6e29806"><div class="ttname"><a href="_accel_stepper_i2_c_8h.html#a7df5712fcf7469a487b493f4f6e29806">runSpeedToPositionCmd</a></div><div class="ttdeci">const uint8_t runSpeedToPositionCmd</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00108">AccelStepperI2C.h:108</a></div></div>
<div class="ttc" id="afirmware_8ino_html_a4d39df1bc00243ef2abb1ad3cc1acf8e"><div class="ttname"><a href="firmware_8ino.html#a4d39df1bc00243ef2abb1ad3cc1acf8e">bufferOut</a></div><div class="ttdeci">SimpleBuffer * bufferOut</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00139">firmware.ino:139</a></div></div>
<div class="ttc" id="a_servo_i2_c_8h_html_ad6ec5d5c7cec42dab211c442066ced31"><div class="ttname"><a href="_servo_i2_c_8h.html#ad6ec5d5c7cec42dab211c442066ced31">servoWriteCmd</a></div><div class="ttdeci">const uint8_t servoWriteCmd</div><div class="ttdef"><b>Definition:</b> <a href="_servo_i2_c_8h_source.html#l00041">ServoI2C.h:41</a></div></div>
<div class="ttc" id="astructdiagnostics_report_html_a6d270ecf9a6ae1f8e717a879c54fc9bd"><div class="ttname"><a href="structdiagnostics_report.html#a6d270ecf9a6ae1f8e717a879c54fc9bd">diagnosticsReport::lastReceiveTime</a></div><div class="ttdeci">uint16_t lastReceiveTime</div><div class="ttdoc">microseconds the slave spent in the most recent onReceive() interrupt</div><div class="ttdef"><b>Definition:</b> <a href="_accel_stepper_i2_c_8h_source.html#l00090">AccelStepperI2C.h:90</a></div></div>
<div class="ttc" id="aversion_8h_html_a18005e714d083d578e7471e9a3dc5355"><div class="ttname"><a href="version_8h.html#a18005e714d083d578e7471e9a3dc5355">VersionMajor</a></div><div class="ttdeci">const uint8_t VersionMajor</div><div class="ttdef"><b>Definition:</b> <a href="version_8h_source.html#l00004">version.h:4</a></div></div>
<div class="ttc" id="astruct_stepper_html_af5fb2f1b7e77f723afebf5f5a4a378ca"><div class="ttname"><a href="struct_stepper.html#af5fb2f1b7e77f723afebf5f5a4a378ca">Stepper::endstopsEnabled</a></div><div class="ttdeci">bool endstopsEnabled</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00243">firmware.ino:243</a></div></div>
<div class="ttc" id="afirmware_8ino_html_ae2a8610cdcfb2697510a8ee83499558e"><div class="ttname"><a href="firmware_8ino.html#ae2a8610cdcfb2697510a8ee83499558e">addStepper</a></div><div class="ttdeci">int8_t addStepper(uint8_t interface=AccelStepper::FULL4WIRE, uint8_t pin1=2, uint8_t pin2=3, uint8_t pin3=4, uint8_t pin4=5, bool enable=true)</div><div class="ttdoc">Assign and initialize new stepper. Calls the AccelStepper's[1/2] constructor</div><div class="ttdef"><b>Definition:</b> <a href="firmware_8ino_source.html#l00305">firmware.ino:305</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d9edf6c004b4a7ff14fe9ae7a92214ee.html">firmware</a></li><li class="navelem"><a class="el" href="firmware_8ino.html">firmware.ino</a></li>
    <li class="footer">Generated on Fri Feb 25 2022 18:36:30 for AccelStepperI2C by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
